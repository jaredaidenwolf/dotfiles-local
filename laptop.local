install_homebrew_packages() {
  fancy_echo "Installing Homebrew and MAS packages ..."
  brew bundle --file=- <<EOF
brew "bat"
brew "eza"
brew "mas"
brew "shellcheck"
brew "spaceship"
brew "sqlite"
brew "zoxide"
cask "1password"
cask "airbuddy"
cask "backblaze"
cask "badgeify"
cask "calibre"
cask "chatgpt"
cask "claude"
cask "cleanmymac"
cask "comictagger"
cask "cursor"
cask "discord"
cask "docker-desktop"
cask "firefox@developer-edition"
cask "google-chrome"
cask "imageoptim"
cask "local"
cask "obsidian"
cask "postman"
cask "raindropio"
cask "rar"
cask "raspberry-pi-imager"
cask "raycast"
cask "reader"
cask "replacicon"
cask "simple-comic"
cask "slack"
cask "sublime-text"
cask "tableplus"
cask "the-unarchiver"
cask "transmit"
cask "transnomino"
cask "utm"
cask "warp"
cask "zoom"
cask "font-fira-code-nerd-font"
cask "font-fira-mono-nerd-font"
mas "Endel", id: 1346247457
mas "Fantastical", id: 975937182
mas "Harvest", id: 506189836
mas "Things", id: 904280696
mas "xScope 4", id: 889428659
EOF
  brew cleanup
}

# Python via asdf
install_python() {
  fancy_echo "Configuring asdf for Python ..."

  # Install Python plugin for asdf
  if ! asdf plugin list | grep -Fq "python"; then
    asdf plugin add python
  else
    asdf plugin update python
  fi

  # Install the latest stable Python version
  local latest_python
  latest_python=$(asdf list all python | grep -E '^[0-9]+\.[0-9]+\.[0-9]+$' | tail -1)
  if ! asdf list python | grep -Fq "$latest_python"; then
    fancy_echo "Installing Python $latest_python ..."
    asdf install python "$latest_python"
    asdf set --home python "$latest_python"
    fancy_echo "Python $latest_python installed and set as global version."
  else
    fancy_echo "Latest Python $latest_python is already installed."
  fi
}

# Main Execution
fancy_echo "Starting setup..."

# Install Homebrew and MAS packages
install_homebrew_packages

# Install and configure latest stable version of Python
install_python

# All done!
fancy_echo "All done! Your laptop is ready."
